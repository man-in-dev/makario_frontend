# ğŸ—ï¸ System Architecture - Razorpay + iThink Integration

## ğŸ“ High-Level Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        MAKARIO PLATFORM                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚   FRONTEND (React)   â”‚         â”‚  BACKEND (Node.js)   â”‚    â”‚
â”‚  â”‚   Port: 8080         â”‚â—„â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚  Port: 5000          â”‚    â”‚
â”‚  â”‚                      â”‚         â”‚                      â”‚    â”‚
â”‚  â”‚ â€¢ Checkout Page      â”‚         â”‚ â€¢ Express Server     â”‚    â”‚
â”‚  â”‚ â€¢ Razorpay Modal     â”‚         â”‚ â€¢ Payment Logic      â”‚    â”‚
â”‚  â”‚ â€¢ Order Form         â”‚         â”‚ â€¢ Signature Verify   â”‚    â”‚
â”‚  â”‚ â€¢ Cart Management    â”‚         â”‚ â€¢ iThink Integration â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚           â”‚                                  â”‚                 â”‚
â”‚           â”‚                                  â”‚                 â”‚
â”‚           â–¼                                  â–¼                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  localStorage        â”‚         â”‚  .env Configuration  â”‚    â”‚
â”‚  â”‚  (Orders)            â”‚         â”‚  (API Keys)          â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                                    â”‚
         â”‚                                    â”‚
         â–¼                                    â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  RAZORPAY API   â”‚              â”‚ iTHINK LOGISTICS â”‚
    â”‚  (Payment)      â”‚              â”‚ (Shipment)       â”‚
    â”‚                 â”‚              â”‚                  â”‚
    â”‚ â€¢ Create Order  â”‚              â”‚ â€¢ Create Shipmentâ”‚
    â”‚ â€¢ Verify Paymentâ”‚              â”‚ â€¢ Track Shipment â”‚
    â”‚ â€¢ Webhooks      â”‚              â”‚ â€¢ AWB Generation â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Request/Response Flow

### Payment Flow

```
User Action
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Frontend: Checkout Page             â”‚
â”‚ - Fill shipping info                â”‚
â”‚ - Select "Online Payment"           â”‚
â”‚ - Click "Proceed to Payment"        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Frontend: POST /api/create-order    â”‚
â”‚ {                                   â”‚
â”‚   amount: 1000,                     â”‚
â”‚   currency: "INR",                  â”‚
â”‚   receipt: "ORD-123"                â”‚
â”‚ }                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Backend: Create Razorpay Order      â”‚
â”‚ - Validate amount                   â”‚
â”‚ - Call Razorpay SDK                 â”‚
â”‚ - Return order ID                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Frontend: Open Razorpay Modal       â”‚
â”‚ - Display payment options           â”‚
â”‚ - UPI, Card, NetBanking             â”‚
â”‚ - User enters details               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Razorpay: Process Payment           â”‚
â”‚ - Validate card/UPI                 â”‚
â”‚ - Process transaction               â”‚
â”‚ - Return payment ID & signature     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Frontend: POST /api/verify-payment  â”‚
â”‚ {                                   â”‚
â”‚   razorpay_order_id: "...",         â”‚
â”‚   razorpay_payment_id: "...",       â”‚
â”‚   razorpay_signature: "...",        â”‚
â”‚   orderDetails: {...}               â”‚
â”‚ }                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Backend: Verify Signature           â”‚
â”‚ - Calculate HMAC-SHA256             â”‚
â”‚ - Compare with received signature   â”‚
â”‚ - Validate order amount             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Backend: Create iThink Shipment     â”‚
â”‚ - Format shipment data              â”‚
â”‚ - Call iThink API                   â”‚
â”‚ - Get shipment ID & AWB             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Backend: Return Success Response    â”‚
â”‚ {                                   â”‚
â”‚   success: true,                    â”‚
â”‚   payment: {...},                   â”‚
â”‚   shipment: {...}                   â”‚
â”‚ }                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Frontend: Save Order & Show Success â”‚
â”‚ - Save to localStorage              â”‚
â”‚ - Clear cart                        â”‚
â”‚ - Show confirmation                 â”‚
â”‚ - Redirect to success page          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“¦ Component Structure

```
Frontend (React)
â”œâ”€â”€ pages/
â”‚   â””â”€â”€ Checkout.tsx
â”‚       â”œâ”€â”€ State Management
â”‚       â”‚   â”œâ”€â”€ shippingInfo
â”‚       â”‚   â”œâ”€â”€ paymentMethod
â”‚       â”‚   â”œâ”€â”€ isProcessing
â”‚       â”‚   â””â”€â”€ orderPlaced
â”‚       â”‚
â”‚       â”œâ”€â”€ Functions
â”‚       â”‚   â”œâ”€â”€ handleInputChange()
â”‚       â”‚   â”œâ”€â”€ handlePlaceOrder()
â”‚       â”‚   â””â”€â”€ handlePaymentVerification()
â”‚       â”‚
â”‚       â””â”€â”€ UI Components
â”‚           â”œâ”€â”€ Shipping Form
â”‚           â”œâ”€â”€ Payment Method Radio
â”‚           â”œâ”€â”€ Order Summary
â”‚           â””â”€â”€ Place Order Button
â”‚
â””â”€â”€ contexts/
    â”œâ”€â”€ CartContext
    â”œâ”€â”€ AuthContext
    â””â”€â”€ LoadingContext

Backend (Node.js)
â”œâ”€â”€ server.js
â”‚   â”œâ”€â”€ Middleware
â”‚   â”‚   â”œâ”€â”€ CORS
â”‚   â”‚   â”œâ”€â”€ bodyParser
â”‚   â”‚   â””â”€â”€ dotenv
â”‚   â”‚
â”‚   â”œâ”€â”€ Routes
â”‚   â”‚   â”œâ”€â”€ POST /api/create-order
â”‚   â”‚   â”œâ”€â”€ POST /api/verify-payment
â”‚   â”‚   â””â”€â”€ GET /api/health
â”‚   â”‚
â”‚   â”œâ”€â”€ Services
â”‚   â”‚   â”œâ”€â”€ Razorpay Service
â”‚   â”‚   â”‚   â”œâ”€â”€ createOrder()
â”‚   â”‚   â”‚   â””â”€â”€ verifySignature()
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ iThink Service
â”‚   â”‚       â””â”€â”€ createShipment()
â”‚   â”‚
â”‚   â””â”€â”€ Error Handling
â”‚       â”œâ”€â”€ Try-catch blocks
â”‚       â”œâ”€â”€ Error logging
â”‚       â””â”€â”€ Error responses
```

---

## ğŸ” Security Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SECURITY LAYERS                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  Layer 1: Frontend Security                                â”‚
â”‚  â”œâ”€ API keys NOT exposed                                   â”‚
â”‚  â”œâ”€ VITE_ prefix for public variables only                 â”‚
â”‚  â””â”€ Sensitive data in .env                                 â”‚
â”‚                                                             â”‚
â”‚  Layer 2: CORS Protection                                  â”‚
â”‚  â”œâ”€ Only allow frontend URL                                â”‚
â”‚  â”œâ”€ Restrict HTTP methods                                  â”‚
â”‚  â””â”€ Validate origin header                                 â”‚
â”‚                                                             â”‚
â”‚  Layer 3: Signature Verification                           â”‚
â”‚  â”œâ”€ HMAC-SHA256 algorithm                                  â”‚
â”‚  â”œâ”€ Backend-only verification                              â”‚
â”‚  â””â”€ Prevent payment tampering                              â”‚
â”‚                                                             â”‚
â”‚  Layer 4: Input Validation                                 â”‚
â”‚  â”œâ”€ Validate order amount                                  â”‚
â”‚  â”œâ”€ Validate customer data                                 â”‚
â”‚  â””â”€ Validate pincode                                       â”‚
â”‚                                                             â”‚
â”‚  Layer 5: API Key Protection                               â”‚
â”‚  â”œâ”€ Keys in .env file                                      â”‚
â”‚  â”œâ”€ Never logged or exposed                                â”‚
â”‚  â””â”€ Rotated regularly                                      â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Data Models

### Order Object
```javascript
{
  id: "ORD-1234567890",
  items: [
    {
      product: {
        id: "1",
        name: "Premium Makhana",
        price: 500,
        image: "..."
      },
      quantity: 2
    }
  ],
  shippingInfo: {
    fullName: "Rajesh Kumar",
    email: "rajesh@example.com",
    phone: "9999999999",
    address: "123 Main St",
    city: "Mumbai",
    state: "Maharashtra",
    pincode: "400001"
  },
  paymentMethod: "online",
  total: 1050,
  orderDate: "2025-10-24T10:30:00Z",
  status: "confirmed",
  paymentId: "pay_xxxxx",
  shipmentData: {...}
}
```

### Shipment Object (iThink)
```javascript
{
  orderid: "ORD-1234567890",
  channel: "Makario",
  paymentmode: "Prepaid",
  totalamount: 1050,
  productdetail: [...],
  consignee: {...},
  pickup: {...}
}
```

---

## ğŸ”Œ API Integration Points

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              EXTERNAL API INTEGRATIONS                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  Razorpay API                                            â”‚
â”‚  â”œâ”€ Endpoint: https://api.razorpay.com                  â”‚
â”‚  â”œâ”€ Method: REST                                         â”‚
â”‚  â”œâ”€ Auth: Basic Auth (Key ID + Key Secret)              â”‚
â”‚  â””â”€ Operations:                                          â”‚
â”‚     â”œâ”€ Create Order                                      â”‚
â”‚     â”œâ”€ Fetch Order                                       â”‚
â”‚     â””â”€ Fetch Payment                                     â”‚
â”‚                                                          â”‚
â”‚  iThink Logistics API                                    â”‚
â”‚  â”œâ”€ Endpoint: https://pre-alpha.ithinklogistics.com     â”‚
â”‚  â”œâ”€ Method: REST                                         â”‚
â”‚  â”œâ”€ Auth: API Key + Secret Key (Headers)                â”‚
â”‚  â””â”€ Operations:                                          â”‚
â”‚     â”œâ”€ Create Shipment                                   â”‚
â”‚     â”œâ”€ Get Shipment Status                               â”‚
â”‚     â””â”€ Generate AWB                                      â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸš€ Deployment Architecture

```
Production Environment
â”‚
â”œâ”€ Frontend (Vercel/Netlify)
â”‚  â”œâ”€ React + Vite
â”‚  â”œâ”€ Environment: .env.production
â”‚  â””â”€ HTTPS enabled
â”‚
â”œâ”€ Backend (Heroku/AWS/DigitalOcean)
â”‚  â”œâ”€ Node.js + Express
â”‚  â”œâ”€ Environment: .env.production
â”‚  â”œâ”€ HTTPS enabled
â”‚  â””â”€ Database (optional)
â”‚
â””â”€ External Services
   â”œâ”€ Razorpay (Live Mode)
   â”œâ”€ iThink Logistics
   â””â”€ Email Service (optional)
```

---

**Last Updated**: 2025-10-24

